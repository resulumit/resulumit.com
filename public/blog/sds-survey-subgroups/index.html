<!doctype html>
<html class="no-js" lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>Calculating standard deviations for survey subgroups in R | Resul Umit</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Carlito|Source+Code+Pro|Droid+Serif" rel="stylesheet">
    <link rel="stylesheet" href="/css/foundation.min.css">
    <link rel="stylesheet" href="/css/highlight.min.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/academicons.min.css">
    <link rel="stylesheet" href="/css/finite.css">
    <link rel="stylesheet" href="/css/kube.css">
    <link rel="stylesheet" href="/css/resulumit.css">
  </head>
  <body>
    <header>
      <nav class="nav-bar">
	
	  <div class="title-bar" data-responsive-toggle="site-menu" data-hide-for="medium">
	    <button class="site-hamburger" type="button" data-toggle>
	      <i class="fa fa-bars fa-lg" aria-hidden="true"></i>
	    </button>
	    <div class="title-bar-title site-title">
	      <a href="/"  style="color: #b3cde0">Resul Umit</a>
	    </div>
	    <div class="title-bar-right pull-right">
	      


	    </div>
	  </div>

	  
	    <div class="top-bar" id="site-menu" >
	      <div class="top-bar-title show-for-medium site-title">
		<a href="/"  style="color: #b3cde0;">Resul Umit</a>
	      </div>
	      <div class="top-bar-left">
		<ul class="menu vertical medium-horizontal">
		  
		  
		  <li><a href="/publications/">Publications</a></li>
		  
		  <li><a href="/unpublished/">Unpublished</a></li>
		  
		  <li><a href="/blog/">Blog</a></li>
		  
		  <li><a href="/outreach/">Outreach</a></li>
		  
		  <li><a href="/teaching/">Teaching</a></li>
		  
		  <li><a href="/about/">About</a></li>
		  
		</ul>
	      </div>
	      <div class="top-bar-right show-for-medium">
		


	      </div>
	    </div>
	  
	</nav>
    </header>
    <main>
      

<div class="wrapper">
<div class="units-row" style='margin-bottom: 0px;'>
<div class="unit-20">&nbsp;</div>
<div class="unit-60"><h1>Calculating standard deviations for survey subgroups in R</h1></div>
</div>
<div class="units-row">
  <div class="unit-20 dateblock" style='text-align: right;'><h3 style='padding-top: .8ex;'><a href="/blog">Blog</a></h3>
      <div class="post-metadata">
  <span class="post-date">
    <time datetime="2018-09-10 00:00:00 &#43;0000 UTC" itemprop="datePublished">10 September 2018</time>
  </span>
  
  
  
  <span class="post-tags">
    <p><i class="fa fa-tags"></i>
    
    <a class="post-tag" href="/categories/rstats">rstats</a>,
     
    
    
    <a class="post-tag" href="/categories/surveys">surveys</a>
    
  </span>
  
  
</div>

    </div>
<div class="unit-60">

  <p>The <a href="https://cran.r-project.org/web/packages/survey/survey.pdf">survey</a> package is one of my favourites in R.</p>
<p>Among its many other uses, it can compute summary statistics by subgroups. For example, if you have a survey of individuals from several countries with an item on the respondents’ income, you can calculate the average income in each subgroup with the <code>svyby()</code> function.</p>
<p>However, like many other functions in the package, <code>svyby()</code> returns <em>standard errors</em>—but not <em>standard deviations</em>—of the mean values. Although it is possible to calculate the standard deviations for all observations with the svyvar() function, with no argument for subgroup analysis, this can quickly become tiresome if you have many subgroups or variables to work with.</p>
<p>I have recently been working witht the <a href="http://www.europeansocialsurvey.org">European Social Survey</a> data, and I needed to calculate the standard deviations of the means of three variabels in 23 countries. hence, I have written a loop, which I am sure I will use again.</p>
<p>Hoping that it might be useful for others as well, I am leaving it here:</p>
<pre class="r"><code>library(survey)
library(tidyverse)

datalist &lt;- list()

for(i in levels(as.factor(df$subgroups))) {
        
  df_subset &lt;- df[df$subgroups == i, ] 
  
  design &lt;- svydesign(id = ~1 , data = df_subset, weight = ~surveyweight)
  
  dat &lt;- data.frame(as.data.frame(sqrt(svyvar(~variable1, na.rm= TRUE, design = design)))[,&quot;variance&quot;],
                    as.data.frame(sqrt(svyvar(~variable2, na.rm= TRUE, design = design)))[,&quot;variance&quot;])
  
  colnames(dat)&lt;-c(&quot;sd.variable1&quot;, &quot;sd.variable2&quot;)
  
  datalist[[i]] &lt;- dat
}

df_sd &lt;- as.data.frame(do.call(rbind, datalist)) %&gt;%
  rownames_to_column() %&gt;%
  rename(subgroups = rowname)</code></pre>
<p>where you will need to change</p>
<ol style="list-style-type: decimal">
<li><em>df</em> with your data frame,</li>
<li><em>subgroups</em> with the variable name for the subgroups (i.e. countries),</li>
<li><em>surveyweight</em> with the weight(s) in your survey, and</li>
<li><em>variable1</em> and <em>variable2</em> with the variable names for which you are calculating the standard deviations.</li>
</ol>


      <meta itemprop="wordCount" content="267">
      <meta itemprop="datePublished" content="2018-09-10">
      <meta itemprop="url" content="/blog/sds-survey-subgroups/">

<div class='sans' style="background: #dddddd; padding: 2em;">
<div style="padding-bottom: 1em" >
<div class="share-box">
  <ul class="share">
    <li>
      <a class="facebook" href="http://www.facebook.com/sharer.php?u=%2fblog%2fsds-survey-subgroups%2f" target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter" href="https://twitter.com/intent/tweet?text=Calculating%20standard%20deviations%20for%20survey%20subgroups%20in%20R. %2fblog%2fsds-survey-subgroups%2f from @ResulUmit" target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fblog%2fsds-survey-subgroups%2f&amp;title=Calculating%20standard%20deviations%20for%20survey%20subgroups%20in%20R" target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo" href="http://service.weibo.com/share/share.php?url=%2fblog%2fsds-survey-subgroups%2f&amp;title=Calculating%20standard%20deviations%20for%20survey%20subgroups%20in%20R" target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email" href="mailto:?subject=Calculating%20standard%20deviations%20for%20survey%20subgroups%20in%20R&amp;body=%2fblog%2fsds-survey-subgroups%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


</div>

    <ul class="pagination" role="navigation" aria-label="Pagination">
      
      <li class="arrow" aria-disabled="true"><a href="/blog/eu-turkey-progress-reports/">&laquo; <em>Previous<span class="show-for-sr"> page</span></em>: EU press releases differ from their reports on Turkey</a></li>
      
      
      <li class="arrow" aria-disabled="true"><a href="/blog/polisci-research-notes/"><em>Next<span class="show-for-sr"> page</span></em>: Research notes in political science journals&nbsp;&raquo;</a></li>
      
    </ul>
    <a href="/blog/">All blog posts by date</a>
</div>

<span style='font-family: Carlito'>

</span>

  </div>
  </div></div>

    </main>
    <footer class="whatisthis">
  <hr class='separator'/>
  <span style="font-family: Carlito, sans; font-size: 0.9em; line-height: 1.05em;">
  <div class="row">
    <div class="column small-12 medium-4">
      <figure class='image-left'>
      <a href="/" style="border-bottom: none;">
      	<img src="/images/resul.jpeg" alt="Portrait of the author" class='avatar' style="max-width: 40%;">
      </a>
  </figure>
  <p>
Resul Umit is a post-doctoral researcher at the <a href="https://www.unilu.ch/en/" target="_blank">University of Lucerne</a>, Switzerland.  </p>
    </div>
    <div class="column small-12 medium-4">
      
      <h3 id="contact">Contact</h3>
      <ul class="fa-ul">
	
	<li><i class="fa-li fa fa-university" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.unilu.ch/en/faculties/faculty-of-humanities-and-social-sciences/institutes-departements-and-research-centres/department-of-political-science/">Department of Political Science, University of Lucerne, Frohburgstrasse 3, 6002 Lucerne, Switzerland.</a></li>
	
	<li><i class="fa-li fa fa-envelope" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="mailto:resul.umit@unilu.ch">resul.umit@unilu.ch</a></li>
	
	<li><i class="fa-li fa fa-twitter" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://twitter.com/ResulUmit">@ResulUmit</a> on Twitter</li>
	
	<li><i class="fa-li ai ai-google-scholar" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://scholar.google.com/citations?user=J5Ck-vkAAAAJ&amp;hl=en">Google Scholar</a></li>
	
      </ul>
    </div>
    <div class="column small-12 medium-4">
      <h3>Subscribe</h3>
      <p><i><i class="fa fa-rss-square" style="color:#03396c;"></i> To receive updates from this site, you can subscribe to using an <a href="http://feeds.feedburner.com/ResulUmit">RSS feed reader</a> or <a href="https://feedburner.google.com/fb/a/mailverify?uri=ResulUmit&amp;loc=en_US">by email</a>.</i></p>
      <h3>Search</h3>
      <a id="searchsite">
	<form method="get" action="https://duckduckgo.com/">
	  <label for="search-field" class="show-for-sr">Search the site</label>
	  <input type="search" name="q" maxlength="255" placeholder="Search the site" id="search-field">
	  <input type="hidden" name="sites" value="https://resulumit.com"/>
	  <input type="hidden" name="k7" value="#faf8f8"/>
	  <input type="hidden" name="kj" value="#b33"/>
	  <input type="hidden" name="ky" value="#fafafa"/>
	  <input type="hidden" name="kx" value="b"/>
	  <input type="hidden" name="ko" value="-1"/>
	  <input type="hidden" name="k1" value="-1"/>
	  <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" />
	</form>
      </a>
    </div>
  </div>
  </span>
</footer>

    <div class="endofpage">
    <footer id="footer">
    <section class="wrapper small">Powered by <a href="http://gohugo.io">Hugo</a> and
    <a href="https://github.com/rstudio/blogdown">Blogdown</a>. Inspired by 
    <a href="https://github.com/rbind/robjhyndman.com">Hyndman</a> and 
    <a href="https://github.com/kjhealy/kieranhealy.hugo">Healy</a>.
   
     &copy; <a href="https://resulumit.com">Resul Umit</a> 2013&ndash;2019.
    </section>
    </footer>
    </div>

    <script src="/js/jquery.js"></script>
    <script src="/js/what-input.js"></script>
    <script src="/js/foundation.min.js"></script>
    <script src="/js/finite.js"></script>

    
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-37636856-2', 'auto');
ga('send', 'pageview');
</script>

 </body>
</html>
